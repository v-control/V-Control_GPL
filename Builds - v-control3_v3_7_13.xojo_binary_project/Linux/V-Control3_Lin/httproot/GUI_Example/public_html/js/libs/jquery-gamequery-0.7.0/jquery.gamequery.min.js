(function(a){var b="gQ_",c=0,d=1,e=2,f=function(b,c){switch(b.geometry){case a.gameQuery.GEOMETRY_RECTANGLE:var d=c*Math.PI*2/360,e=Math.abs(Math.cos(d)*b.width/2*b.factor)+Math.abs(Math.sin(d)*b.height/2*b.factor),f=Math.abs(Math.cos(d)*b.height/2*b.factor)+Math.abs(Math.sin(d)*b.width/2*b.factor);return{x:e,y:f}}},g=function(b,c,d,e){if(b.geometry==a.gameQuery.GEOMETRY_RECTANGLE&&d.geometry==a.gameQuery.GEOMETRY_RECTANGLE){var g=e.x+d.boundingCircle.x-b.boundingCircle.x-c.x,h=e.y+d.boundingCircle.y-b.boundingCircle.y-c.y,i=Math.atan(h/g),j=Math.abs(Math.cos(i-b.angle*Math.PI*2/360)/Math.cos(i)*g),k=Math.abs(Math.sin(i-b.angle*Math.PI*2/360)/Math.sin(i)*h),l=f(d,d.angle-b.angle);if(j>=b.width/2*b.factor+l.x||k>=b.height/2*b.factor+l.y)return!1;var j=Math.abs(Math.cos(i-d.angle*Math.PI*2/360)/Math.cos(i)*-g),k=Math.abs(Math.sin(i-d.angle*Math.PI*2/360)/Math.sin(i)*-h),l=f(b,b.angle-d.angle);return j>=d.width/2*d.factor+l.x||k>=d.height/2*d.factor+l.y?!1:!0}return!1},h=function(b){var c={x:0,y:0},d=b[0];while(d!==a.gameQuery.playground[0]&&d.gameQuery!==void 0)c.x+=d.gameQuery.posx,c.y+=d.gameQuery.posy,d=d.parentNode;return c},i=function(b,c){c===void 0&&(c=h(b));var d=b[0].gameQuery;return{firstRow:Math.max(Math.min(Math.floor(-c.y/d.height),d.sizey),0),lastRow:Math.max(Math.min(Math.ceil((a.gameQuery.playground[0].height-c.y)/d.height),d.sizey),0),firstColumn:Math.max(Math.min(Math.floor(-c.x/d.width),d.sizex),0),lastColumn:Math.max(Math.min(Math.ceil((a.gameQuery.playground[0].width-c.x)/d.width),d.sizex),0)}},j=function(a,b){var c=a[0].gameQuery;return{firstRow:Math.max(Math.min(b.firstRow-c.buffer,c.sizey),0),lastRow:Math.max(Math.min(b.lastRow+c.buffer,c.sizey),0),firstColumn:Math.max(Math.min(b.firstColumn-c.buffer,c.sizex),0),lastColumn:Math.max(Math.min(b.lastColumn+c.buffer,c.sizex),0)}},k=function(b,c,d){var g,e=b[0].gameQuery,f=b.attr("id");g=e.func?e.tiles(c,d)-1:e.tiles[c][d]-1;var h;if(h=e.multi?e.animations:e.animations[g],g>=0){b.addSprite(a.gameQuery.tileIdPrefix+f+"_"+c+"_"+d,{width:e.width,height:e.height,posx:d*e.width,posy:c*e.height,animation:h});var i=b.find("#"+a.gameQuery.tileIdPrefix+f+"_"+c+"_"+d);e.multi?i.setAnimation(g):i[0].gameQuery.animationNumber=g,i.removeClass(a.gameQuery.spriteCssClass),i.addClass(a.gameQuery.tileCssClass),i.addClass(a.gameQuery.tileTypePrefix+g)}};a.extend({gameQuery:{Animation:function(b,c){var d={imageURL:"",numberOfFrame:1,delta:0,rate:30,type:0,distance:0,offsetx:0,offsety:0};return b=a.extend(d,b),this.imageURL=b.imageURL,this.numberOfFrame=b.numberOfFrame,this.delta=b.delta,this.rate=b.rate,this.type=b.type,this.distance=b.distance,this.offsetx=b.offsetx,this.offsety=b.offsety,a.gameQuery.resourceManager.addAnimation(this,c),!0},ANIMATION_VERTICAL:1,ANIMATION_HORIZONTAL:2,ANIMATION_ONCE:4,ANIMATION_CALLBACK:8,ANIMATION_MULTI:16,ANIMATION_PINGPONG:32,GEOMETRY_RECTANGLE:1,GEOMETRY_DISC:2,refreshRate:30,resourceManager:{animations:[],sounds:[],callbacks:[],loadedAnimationsPointer:0,loadedSoundsPointer:0,preload:function(){for(var b=this.animations.length-1;b>=this.loadedAnimationsPointer;b--)this.animations[b].domO=new Image,this.animations[b].domO.src=this.animations[b].imageURL;for(var b=this.sounds.length-1;b>=this.loadedSoundsPointer;b--)this.sounds[b].load();a.gameQuery.resourceManager.waitForResources()},waitForResources:function(){for(var b=0,e=this.loadedAnimationsPointer;this.animations.length>e;e++)this.animations[e].domO.complete&&b++;for(var f=0,e=this.loadedSoundsPointer;this.sounds.length>e;e++){var g=this.sounds[e].ready();g&&f++}if(a.gameQuery.resourceManager.loadCallback){var h=(b+f)/(this.animations.length+this.sounds.length-this.loadedAnimationsPointer-this.loadedSoundsPointer)*100;a.gameQuery.resourceManager.loadCallback(h)}this.animations.length+this.sounds.length-this.loadedAnimationsPointer-this.loadedSoundsPointer>b+f?imgWait=setTimeout(function(){a.gameQuery.resourceManager.waitForResources()},100):(this.loadedAnimationsPointer=this.animations.length,this.loadedSoundsPointer=this.sounds.length,a.gameQuery.scenegraph.children().each(function(){a(this).children().each(arguments.callee),this.gameQuery&&this.gameQuery.animation&&(a(this).css("background-image","url("+this.gameQuery.animation.imageURL+")"),this.gameQuery.animation.type&a.gameQuery.ANIMATION_VERTICAL?a(this).css("background-repeat","repeat-x"):this.gameQuery.animation.type&a.gameQuery.ANIMATION_HORIZONTAL?a(this).css("background-repeat","repeat-y"):a(this).css("background-repeat","no-repeat"))}),a.gameQuery.state===c&&setInterval(function(){a.gameQuery.resourceManager.refresh()},a.gameQuery.refreshRate),a.gameQuery.state=d,a.gameQuery.startCallback&&a.gameQuery.startCallback(),a.gameQuery.scenegraph.css("visibility","visible"))},refreshSprite:function(){if(this.gameQuery!=void 0){var b=this.gameQuery;b.animation&&(b.idleCounter==b.animation.rate-1&&b.playing&&(b.animation.type&a.gameQuery.ANIMATION_ONCE?b.animation.numberOfFrame-1>b.currentFrame?b.currentFrame+=b.frameIncrement:b.currentFrame==b.animation.numberOfFrame-1&&b.animation.type&a.gameQuery.ANIMATION_CALLBACK&&a.isFunction(b.callback)&&b.callback(this):(b.animation.type&a.gameQuery.ANIMATION_PINGPONG&&(b.currentFrame==b.animation.numberOfFrame-1&&b.frameIncrement==1?b.frameIncrement=-1:b.currentFrame==0&&b.frameIncrement==-1&&(b.frameIncrement=1)),b.currentFrame=(b.currentFrame+b.frameIncrement)%b.animation.numberOfFrame,b.currentFrame==0&&b.animation.type&a.gameQuery.ANIMATION_CALLBACK&&a.isFunction(b.callback)&&b.callback(this)),b.animation.type&a.gameQuery.ANIMATION_VERTICAL&&b.animation.numberOfFrame>1?b.multi?a(this).css("background-position",""+(-b.animation.offsetx-b.multi)+"px "+(-b.animation.offsety-b.animation.delta*b.currentFrame)+"px"):a(this).css("background-position",""+-b.animation.offsetx+"px "+(-b.animation.offsety-b.animation.delta*b.currentFrame)+"px"):b.animation.type&a.gameQuery.ANIMATION_HORIZONTAL&&b.animation.numberOfFrame>1&&(b.multi?a(this).css("background-position",""+(-b.animation.offsetx-b.animation.delta*b.currentFrame)+"px "+(-b.animation.offsety-b.multi)+"px"):a(this).css("background-position",""+(-b.animation.offsetx-b.animation.delta*b.currentFrame)+"px "+-b.animation.offsety+"px"))),b.idleCounter=(b.idleCounter+1)%b.animation.rate)}return!0},refreshTilemap:function(){if(this.gameQuery!=void 0){var b=this.gameQuery;if(a.isArray(b.frameTracker))for(var c=0;b.frameTracker.length>c;c++)b.idleCounter[c]==b.animations[c].rate-1&&(b.animations[c].type&a.gameQuery.ANIMATION_ONCE?b.animations[c].numberOfFrame-1>b.frameTracker[c]&&(b.frameTracker[c]+=b.frameIncrement[c]):(b.animations[c].type&a.gameQuery.ANIMATION_PINGPONG&&(b.frameTracker[c]==b.animations[c].numberOfFrame-1&&b.frameIncrement[c]==1?b.frameIncrement[c]=-1:b.frameTracker[c]==0&&b.frameIncrement[c]==-1&&(b.frameIncrement[c]=1)),b.frameTracker[c]=(b.frameTracker[c]+b.frameIncrement[c])%b.animations[c].numberOfFrame)),b.idleCounter[c]=(b.idleCounter[c]+1)%b.animations[c].rate;else b.idleCounter==b.animations.rate-1&&(b.animations.type&a.gameQuery.ANIMATION_ONCE?b.animations.numberOfFrame-1>b.frameTracker&&(b.frameTracker+=b.frameIncrement):(b.animations.type&a.gameQuery.ANIMATION_PINGPONG&&(b.frameTracker==b.animations.numberOfFrame-1&&b.frameIncrement==1?b.frameIncrement=-1:b.frameTracker==0&&b.frameIncrement==-1&&(b.frameIncrement=1)),b.frameTracker=(b.frameTracker+b.frameIncrement)%b.animations.numberOfFrame)),b.idleCounter=(b.idleCounter+1)%b.animations.rate;a(this).find("."+a.gameQuery.tileCssClass).each(function(){if(a.isArray(b.frameTracker)){var c=this.gameQuery.animationNumber;b.animations[c].type&a.gameQuery.ANIMATION_VERTICAL&&b.animations[c].numberOfFrame>1?a(this).css("background-position",""+-b.animations[c].offsetx+"px "+(-b.animations[c].offsety-b.animations[c].delta*b.frameTracker[c])+"px"):b.animations[c].type&a.gameQuery.ANIMATION_HORIZONTAL&&b.animations[c].numberOfFrame>1&&a(this).css("background-position",""+(-b.animations[c].offsetx-b.animations[c].delta*b.frameTracker[c])+"px "+-b.animations[c].offsety+"px")}else b.animations.type&a.gameQuery.ANIMATION_VERTICAL&&b.animations.numberOfFrame>1?a(this).css("background-position",""+(-b.animations.offsetx-this.gameQuery.multi)+"px "+(-b.animations.offsety-b.animations.delta*b.frameTracker)+"px"):b.animations.type&a.gameQuery.ANIMATION_HORIZONTAL&&b.animations.numberOfFrame>1&&a(this).css("background-position",""+(-b.animations.offsetx-b.animations.delta*b.frameTracker)+"px "+(-b.animations.offsety-this.gameQuery.multi)+"px")})}return!0},refresh:function(){if(a.gameQuery.state===d){a.gameQuery.playground.find("."+a.gameQuery.spriteCssClass).each(this.refreshSprite),a.gameQuery.playground.find("."+a.gameQuery.tilemapCssClass).each(this.refreshTilemap);for(var b=Array(),c=this.callbacks.length-1;c>=0;c--){if(this.callbacks[c].idleCounter==this.callbacks[c].rate-1){var e=this.callbacks[c].fn();typeof e=="boolean"?e&&b.push(c):typeof e=="number"&&(this.callbacks[c].rate=Math.round(e/a.gameQuery.refreshRate),this.callbacks[c].idleCounter=0)}this.callbacks[c].idleCounter=(this.callbacks[c].idleCounter+1)%this.callbacks[c].rate}for(var c=b.length-1;c>=0;c--)this.callbacks.splice(b[c],1)}},addAnimation:function(b,f){if(0>a.inArray(b,this.animations))switch(b.rate=Math.round(b.rate/a.gameQuery.refreshRate),b.rate==0&&(b.rate=1),this.animations.push(b),a.gameQuery.state){case c:case e:break;case d:this.animations[this.loadedAnimationsPointer].domO=new Image,this.animations[this.loadedAnimationsPointer].domO.src=b.imageURL,f!==void 0&&(this.animations[this.loadedAnimationsPointer].domO.onload=f),this.loadedAnimationsPointer++}},addSound:function(b){if(0>a.inArray(b,this.sounds))switch(this.sounds.push(b),a.gameQuery.state){case c:case e:break;case d:b.load(),this.loadedSoundsPointer++}},registerCallback:function(b,c){c=Math.round(c/a.gameQuery.refreshRate),c==0&&(c=1),this.callbacks.push({fn:b,rate:c,idleCounter:0})},clear:function(a){this.animations=[],this.loadedAnimationsPointer=0,this.sounds=[],this.loadedSoundsPointer=0,a&&(this.callbacks=[])}},update:function(b,c){if(a.isPlainObject(b))var d=b;else if(b.length>0)var d=b[0].gameQuery;else var d=b.gameQuery;if(d)if(d.tileSet===!0){var e=i(b),f=d.buffered;for(property in c)switch(property){case"x":if(e.lastColumn>f.lastColumn){for(var g=b[0].parentNode,h=b.detach(),l=j(b,e),m=d.buffered.firstRow;d.buffered.lastRow>m;m++){for(var n=d.buffered.firstColumn;Math.min(l.firstColumn,d.buffered.lastColumn)>n;n++)h.find("#"+a.gameQuery.tileIdPrefix+b.attr("id")+"_"+m+"_"+n).remove();for(var n=Math.max(d.buffered.lastColumn,l.firstColumn);l.lastColumn>n;n++)k(h,m,n)}d.buffered.firstColumn=l.firstColumn,d.buffered.lastColumn=l.lastColumn,h.appendTo(g)}if(f.firstColumn>e.firstColumn){for(var g=b[0].parentNode,h=b.detach(),l=j(b,e),m=d.buffered.firstRow;d.buffered.lastRow>m;m++){for(var n=Math.max(l.lastColumn,d.buffered.firstColumn);d.buffered.lastColumn>n;n++)h.find("#"+a.gameQuery.tileIdPrefix+b.attr("id")+"_"+m+"_"+n).remove();for(var n=l.firstColumn;Math.min(d.buffered.firstColumn,l.lastColumn)>n;n++)k(h,m,n)}d.buffered.firstColumn=l.firstColumn,d.buffered.lastColumn=l.lastColumn,h.appendTo(g)}break;case"y":if(e.lastRow>f.lastRow){for(var g=b[0].parentNode,h=b.detach(),l=j(b,e),n=d.buffered.firstColumn;d.buffered.lastColumn>n;n++){for(var m=d.buffered.firstRow;Math.min(l.firstRow,d.buffered.lastRow)>m;m++)h.find("#"+a.gameQuery.tileIdPrefix+b.attr("id")+"_"+m+"_"+n).remove();for(var m=Math.max(d.buffered.lastRow,l.firstRow);l.lastRow>m;m++)k(h,m,n)}d.buffered.firstRow=l.firstRow,d.buffered.lastRow=l.lastRow,h.appendTo(g)}if(f.firstRow>e.firstRow){for(var g=b[0].parentNode,h=b.detach(),l=j(b,e),n=d.buffered.firstColumn;d.buffered.lastColumn>n;n++){for(var m=Math.max(l.lastRow,d.buffered.firstRow);d.buffered.lastRow>m;m++)h.find("#"+a.gameQuery.tileIdPrefix+b.attr("id")+"_"+m+"_"+n).remove();for(var m=l.firstRow;Math.min(d.buffered.firstRow,l.lastRow)>m;m++)k(h,m,n)}d.buffered.firstRow=l.firstRow,d.buffered.lastRow=l.lastRow,h.appendTo(g)}break;case"angle":break;case"factor":}}else{var o=a.gameQuery.playground&&!a.gameQuery.playground.disableCollision;for(property in c)switch(property){case"x":o&&(d.boundingCircle.x=d.posx+d.width/2);break;case"y":o&&(d.boundingCircle.y=d.posy+d.height/2);break;case"w":case"h":d.boundingCircle.originalRadius=Math.sqrt(Math.pow(d.width,2)+Math.pow(d.height,2))/2,d.boundingCircle.radius=d.factor*d.boundingCircle.originalRadius;break;case"angle":d.angle=parseFloat(c.angle);break;case"factor":d.factor=parseFloat(c.factor),o&&(d.boundingCircle.radius=d.factor*d.boundingCircle.originalRadius)}}},state:c,spriteCssClass:b+"sprite",groupCssClass:b+"group",tilemapCssClass:b+"tilemap",tileCssClass:b+"tile",tileTypePrefix:b+"tileType_",tileIdPrefix:b+"tile_"},muteSound:function(b){for(var c=a.gameQuery.resourceManager.sounds.length-1;c>=0;c--)a.gameQuery.resourceManager.sounds[c].muted(b)},playground:function(){return a.gameQuery.playground},loadCallback:function(b){a.gameQuery.resourceManager.loadCallback=b}});var l=a("<div class='"+a.gameQuery.spriteCssClass+"'  style='position: absolute; display: block; overflow: hidden' />"),m=a("<div class='"+a.gameQuery.groupCssClass+"'  style='position: absolute; display: block; overflow: hidden' />"),n=a("<div class='"+a.gameQuery.tilemapCssClass+"' style='position: absolute; display: block; overflow: hidden;' />");a.fn.extend({playground:function(c){if(this.length==1){if(this[0]==document)throw"Old playground usage, use $.playground() to retreive the playground and $('mydiv').playground(options) to set the div!";c=a.extend({height:320,width:480,refreshRate:30,position:"absolute",keyTracker:!1,mouseTracker:!1,disableCollision:!1},c),a.gameQuery.playground=this,a.gameQuery.refreshRate=c.refreshRate,a.gameQuery.playground[0].height=c.height,a.gameQuery.playground[0].width=c.width,a.gameQuery.playground.css({position:c.position,display:"block",overflow:"hidden",height:c.height+"px",width:c.width+"px"}).append("<div id='"+b+"scenegraph' style='visibility: hidden'/>"),a.gameQuery.scenegraph=a("#"+b+"scenegraph"),a.gameQuery.keyTracker={},c.keyTracker&&(a(document).keydown(function(b){a.gameQuery.keyTracker[b.keyCode]=!0}),a(document).keyup(function(b){a.gameQuery.keyTracker[b.keyCode]=!1})),a.gameQuery.mouseTracker={x:0,y:0};var d=a.gameQuery.playground.offset();c.mouseTracker&&(a(a.gameQuery.playground).mousemove(function(b){a.gameQuery.mouseTracker.x=b.pageX-d.left,a.gameQuery.mouseTracker.y=b.pageY-d.top}),a(document).mousedown(function(b){a.gameQuery.mouseTracker[b.which]=!0}),a(document).mouseup(function(b){a.gameQuery.mouseTracker[b.which]=!1}))}return this},startGame:function(b){return a.gameQuery.startCallback=b,a.gameQuery.resourceManager.preload(),this},pauseGame:function(){return a.gameQuery.state=e,a.gameQuery.scenegraph.css("visibility","hidden"),this},resumeGame:function(b){return a.gameQuery.state===e&&(a.gameQuery.startCallback=b,a.gameQuery.resourceManager.preload()),this},clearScenegraph:function(){return a.gameQuery.scenegraph.empty(),this},clearAll:function(b){return a.gameQuery.scenegraph.empty(),a.gameQuery.resourceManager.clear(b),this},addGroup:function(b,c){c=a.extend({width:32,height:32,posx:0,posy:0,posz:0,posOffsetX:0,posOffsetY:0,overflow:"visible",geometry:a.gameQuery.GEOMETRY_RECTANGLE,angle:0,factor:1,factorh:1,factorv:1},c);var d=m.clone().attr("id",b).css({overflow:c.overflow,top:c.posy,left:c.posx,height:c.height,width:c.width});return this==a.gameQuery.playground?a.gameQuery.scenegraph.append(d):(this==a.gameQuery.scenegraph||this.hasClass(a.gameQuery.groupCssClass))&&this.append(d),d[0].gameQuery=c,d[0].gameQuery.boundingCircle={x:c.posx+c.width/2,y:c.posy+c.height/0,originalRadius:Math.sqrt(Math.pow(c.width,2)+Math.pow(c.height,2))/2},d[0].gameQuery.boundingCircle.radius=d[0].gameQuery.boundingCircle.originalRadius,d[0].gameQuery.group=!0,this.pushStack(d)},addSprite:function(b,c){c=a.extend({width:32,height:32,posx:0,posy:0,posz:0,posOffsetX:0,posOffsetY:0,idleCounter:0,currentFrame:0,frameIncrement:1,geometry:a.gameQuery.GEOMETRY_RECTANGLE,angle:0,factor:1,playing:!0,factorh:1,factorv:1},c);var e=l.clone().attr("id",b).css({height:c.height,width:c.width,left:c.posx,top:c.posy,backgroundPosition:(c.animation?-c.animation.offsetx:0)+"px "+(c.animation?-c.animation.offsety:0)+"px"});this==a.gameQuery.playground?a.gameQuery.scenegraph.append(e):this.append(e),c.animation&&(a.gameQuery.state===d&&c.animation.imageURL!==""&&e.css("background-image","url("+c.animation.imageURL+")"),c.animation.type&a.gameQuery.ANIMATION_VERTICAL?e.css("background-repeat","repeat-x"):c.animation.type&a.gameQuery.ANIMATION_HORIZONTAL?e.css("background-repeat","repeat-y"):e.css("background-repeat","no-repeat"));var f=e[0];return f!=void 0&&(f.gameQuery=c,f.gameQuery.boundingCircle={x:c.posx+c.width/2,y:c.posy+c.height/2,originalRadius:Math.sqrt(Math.pow(c.width,2)+Math.pow(c.height,2))/2},f.gameQuery.boundingCircle.radius=f.gameQuery.boundingCircle.originalRadius),this},addTilemap:function(b,c,d,e){e=a.extend({width:32,height:32,sizex:32,sizey:32,posx:0,posy:0,posz:0,posOffsetX:0,posOffsetY:0,factorh:1,factorv:1,buffer:1},e);var f=n.clone().attr("id",b).css({top:e.posy,left:e.posx,height:e.height*e.sizey,width:e.width*e.sizex});this==a.gameQuery.playground?a.gameQuery.scenegraph.append(f):this.append(f),f[0].gameQuery=e;var g=f[0].gameQuery;if(g.tileSet=!0,g.tiles=c,g.func=typeof c=="function",a.isArray(d)){for(var h=[],l=[],m=[],o=0;d.length>o;o++)h[o]=0,l[o]=0,m[o]=1;g.frameTracker=h,g.animations=d,g.idleCounter=l,g.frameIncrement=m,g.multi=!1}else g.frameTracker=0,g.frameIncrement=1,g.animations=d,g.idleCounter=0,g.multi=!0;var p=i(f),q=j(f,p);g.buffered=q;for(var o=q.firstRow;q.lastRow>o;o++)for(var r=q.firstColumn;q.lastColumn>r;r++)k(f,o,r);return this.pushStack(f)},pauseAnimation:function(){return this[0].gameQuery.playing=!1,this},resumeAnimation:function(){return this[0].gameQuery.playing=!0,this},setAnimation:function(b,c){var d=this[0].gameQuery;if(typeof b=="number"){if(d.animation.type&a.gameQuery.ANIMATION_MULTI){var e=d.animation.distance*b;d.multi=e,d.frameIncrement=1,d.currentFrame=0,d.animation.type&a.gameQuery.ANIMATION_VERTICAL?this.css("background-position",""+(-e-d.animation.offsetx)+"px "+-d.animation.offsety+"px"):d.animation.type&a.gameQuery.ANIMATION_HORIZONTAL&&this.css("background-position",""+-d.animation.offsetx+"px "+(-e-d.animation.offsety)+"px")}}else b?(d.animation=b,d.currentFrame=0,d.frameIncrement=1,b.imageURL!==""&&this.css("backgroundImage","url('"+b.imageURL+"')"),this.css({"background-position":""+-b.offsetx+"px "+-b.offsety+"px"}),d.animation.type&a.gameQuery.ANIMATION_VERTICAL?this.css("background-repeat","repeat-x"):d.animation.type&a.gameQuery.ANIMATION_HORIZONTAL?this.css("background-repeat","repeat-y"):this.css("background-repeat","no-repeat")):this.css("background-image","");return c!=void 0&&(this[0].gameQuery.callback=c),this},registerCallback:function(b,c){return a.gameQuery.resourceManager.registerCallback(b,c),this},collision:function(b,c){var d,e;a.isPlainObject(b)?e=b:typeof b=="string"&&(d=b),a.isPlainObject(c)?e=c:typeof c=="string"&&(d=c);var f=[],h=this[0].parentNode,i=0,j=0;while(h!=a.gameQuery.playground[0])h.gameQuery&&(i+=h.gameQuery.posx,j+=h.gameQuery.posy),h=h.parentNode;var k={top:0,left:0,bottom:a.playground().height(),right:a.playground().width()},l=jQuery.extend(!0,{},this[0].gameQuery),m=jQuery.extend(!0,{},l.boundingCircle);if(e&&e.w&&(l.width=e.w),e&&e.h&&(l.height=e.h),m.originalRadius=Math.sqrt(Math.pow(l.width,2)+Math.pow(l.height,2))/2,m.radius=l.factor*m.originalRadius,e&&e.x&&(m.x=e.x+l.width/2),e&&e.y&&(m.y=e.y+l.height/2),l.boundingCircle=m,k.top>l.boundingCircle.y+l.boundingCircle.radius+j||k.left>l.boundingCircle.x+l.boundingCircle.radius+i||l.boundingCircle.y-l.boundingCircle.radius+j>k.bottom||l.boundingCircle.x-l.boundingCircle.radius+i>k.right)return this.pushStack(new a([]));if(this!==a.gameQuery.playground){var n=Array();n.push(a.gameQuery.scenegraph.children(d).get()),n[0].offsetX=0,n[0].offsetY=0;for(var o=0,p=n.length;p>o;o++){var q=n[o].length;while(q--){var r=n[o][q];if(r.gameQuery){if(!r.gameQuery.group&&!r.gameQuery.tileSet&&this[0]!=r){var s=Math.sqrt(Math.pow(j+l.boundingCircle.y-n[o].offsetY-r.gameQuery.boundingCircle.y,2)+Math.pow(i+l.boundingCircle.x-n[o].offsetX-r.gameQuery.boundingCircle.x,2));0>=s-l.boundingCircle.radius-r.gameQuery.boundingCircle.radius&&g(l,{x:i,y:j},r.gameQuery,{x:n[o].offsetX,y:n[o].offsetY})&&f.push(n[o][q])}var t=a(r).children(d);t.length&&(n.push(t.get()),n[p].offsetX=r.gameQuery.posx+n[o].offsetX,n[p].offsetY=r.gameQuery.posy+n[o].offsetY,p++)}}}return this.pushStack(a(f))}},addSound:function(b,c){if(a.gameQuery.SoundWrapper){var d=this[0].gameQuery;if(c){var e=d.sounds;e?e.push(b):d.sounds=[b]}else d.sounds=[b]}return this},playSound:function(){return a(this).each(function(){var a=this.gameQuery;if(a.sounds)for(var b=a.sounds.length-1;b>=0;b--)a.sounds[b].play()}),this},stopSound:function(){return a(this).each(function(){var a=this.gameQuery;if(a.sounds)for(var b=a.sounds.length-1;b>=0;b--)a.sounds[b].stop()}),this},pauseSound:function(){return a(this).each(function(){var a=this.gameQuery;if(a.sounds)for(var b=a.sounds.length-1;b>=0;b--)a.sounds[b].pause()}),this},muteSound:function(b){return a(this).each(function(){var a=this.gameQuery;if(a.sounds)for(var c=a.sounds.length-1;c>=0;c--)a.sounds[c].muted(b)}),this},transform:function(b,c){var d=this[0].gameQuery;if(a.gameQuery.update(d,{angle:b,factor:c}),this.css("MozTransform")){var e="rotate("+b+"deg) scale("+c*d.factorh+","+c*d.factorv+")";this.css("MozTransform",e)}else if(this.css("-o-transform")){var e="rotate("+b+"deg) scale("+c*d.factorh+","+c*d.factorv+")";this.css("-o-transform",e)}else if(this.css("msTransform")!==null&&this.css("msTransform")!==void 0){var e="rotate("+b+"deg) scale("+c*d.factorh+","+c*d.factorv+")";this.css("msTransform",e)}else if(this.css("WebkitTransform")!==null&&this.css("WebkitTransform")!==void 0){var e="rotate("+b+"deg) scale("+c*d.factorh+","+c*d.factorv+")";this.css("WebkitTransform",e)}else if(this.css("filter")!==void 0){var f=Math.PI*2/360*b,g=Math.cos(f)*c,h=Math.sin(f)*c;this.css("filter","progid:DXImageTransform.Microsoft.Matrix(M11="+g*d.factorh+",M12="+-h*d.factorv+",M21="+h*d.factorh+",M22="+g*d.factorv+",SizingMethod='auto expand',FilterType='nearest neighbor')");var i=this.width(),j=this.height();d.posOffsetX=(i-d.width)/2,d.posOffsetY=(j-d.height)/2,this.css("left",""+(d.posx-d.posOffsetX)+"px"),this.css("top",""+(d.posy-d.posOffsetY)+"px")}return this},rotate:function(a){var b=this[0].gameQuery;if(a!==void 0)return this.transform(a%360,this.scale());var c=b.angle;return c?c:0},scale:function(a){var b=this[0].gameQuery;if(a!==void 0)return this.transform(this.rotate(),a);var c=b.factor;return c?c:1},fliph:function(a){var b=this[0].gameQuery;return a===void 0?b.factorh!==void 0?b.factorh===-1:!1:(b.factorh=a?-1:1,this.transform(this.rotate(),this.scale()))},flipv:function(a){var b=this[0].gameQuery;return a===void 0?b.factorv!==void 0?b.factorv===-1:!1:(b.factorv=a?-1:1,this.transform(this.rotate(),this.scale()))},xyz:function(a,b,c,d){return a===void 0?this.getxyz():this.setxyz({x:a,y:b,z:c},d)},x:function(a,b){return a===void 0?this.getxyz().x:this.setxyz({x:a},b)},y:function(a,b){return a===void 0?this.getxyz().y:this.setxyz({y:a},b)},z:function(a,b){return a===void 0?this.getxyz().z:this.setxyz({z:a},b)},xy:function(a,b,c){return a===void 0?this.getxyz():this.setxyz({x:a,y:b},c)},wh:function(a,b,c){return a===void 0?this.getwh():this.setwh({w:a,h:b},c)},w:function(a,b){return a===void 0?this.getwh().w:this.setwh({w:a},b)},h:function(a,b){return a===void 0?this.getwh().h:this.setwh({h:a},b)},getxyz:function(){var a=this[0].gameQuery;return{x:a.posx,y:a.posy,z:a.posz}},setxyz:function(b,c){var d=this[0].gameQuery;for(coordinate in b)switch(coordinate){case"x":c&&(b.x+=d.posx),d.posx=b.x,this.css("left",""+(d.posx+d.posOffsetX)+"px"),this.find("."+a.gameQuery.tilemapCssClass).each(function(){a(this).x(0,!0)});break;case"y":c&&(b.y+=d.posy),d.posy=b.y,this.css("top",""+(d.posy+d.posOffsetY)+"px"),this.find("."+a.gameQuery.tilemapCssClass).each(function(){a(this).y(0,!0)});break;case"z":c&&(b.z+=d.posz),d.posz=b.z,this.css("z-index",d.posz)}return a.gameQuery.update(this,b),this},getwh:function(){var a=this[0].gameQuery;return{w:a.width,h:a.height}},setwh:function(b,c){var d=this[0].gameQuery;for(coordinate in b)switch(coordinate){case"w":c&&(b.w+=d.width),d.width=b.w,this.css("width",""+d.width+"px");break;case"h":c&&(b.h+=d.height),d.height=b.h,this.css("height",""+d.height+"px")}return a.gameQuery.update(this,b),this}}),a.extend({gQ:a.gameQuery})})(jQuery)